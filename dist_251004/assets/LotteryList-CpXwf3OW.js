import{d as O,I as V,u as E,s as Q,i as C,r as y,J as m,C as G,o as H,b as J,c as u,e as c,f as t,j as l,n as K,t as r,g as b,D as x,F as W,p as X,q as S,K as Y,L as I,M as Z,N as ee,O as T,P as te,Q as oe,x as se,l as re,_ as ae}from"./index-sn2Iz1lD.js";import{g as ne,a as le,c as B}from"./app-WF9V_EMG.js";const ie=["src"],de={class:"bg-white px-4 py-3 flex justify-between items-center border-b border-gray-100 rounded-t-2xl -mt-2 relative z-10",style:{"margin-top":"-2rem","background-color":"#feedea"}},ce={class:"text-lg font-bold text-gray-900 flex items-center",style:{height:"2rem","line-height":"2rem"}},ue={class:"flex items-center space-x-2"},he={class:"px-4 py-4 pb-8 z-10 relative",style:{background:"linear-gradient(to bottom, #feedea, #fafafa)","min-height":"calc(100vh - 12rem)"}},ge={key:0,class:"mb-10 bg-red-50 border border-red-200 rounded-lg p-4 text-center"},me={class:"text-red-700 mb-1"},pe={key:1,class:"flex justify-center py-24"},fe={class:"cosmos-loader"},ye={class:"text-gray-600 mt-4 animate-pulse"},ve={key:2,class:"flex flex-col items-center justify-center py-24"},be={class:"text-2xl text-gray-700 mt-6 mb-2"},xe={class:"text-gray-500 mb-8"},we={key:3,class:"relative"},ke={class:"space-y-3"},_e={class:"flex p-3 items-start",style:{"min-height":"6rem"}},Le={class:"relative flex-shrink-0 overflow-hidden bg-gray-100 rounded-lg",style:{width:"9rem","min-width":"9rem",height:"6rem","min-height":"6rem"}},Me=["src"],Ce={class:"absolute top-2 left-2"},Se={class:"flex-1 ml-3 flex flex-col justify-between",style:{height:"6rem","min-height":"6rem"}},Ie={class:"text-base font-semibold text-gray-900 mb-1 line-clamp-2 text-left leading-tight"},Te={class:"flex items-center text-xs text-gray-600 mb-2"},Be={class:"font-medium text-gray-700"},Ue={class:"text-sm text-gray-500 mb-1 text-left"},De=O({__name:"LotteryList",setup(je){const{t:a}=V(),w=E(),k=Q(),U=C("openLoginReminder"),D=C("isLoggedIn"),p=y(m()),v=y([]),f=y(!0),h=y(""),j=G(()=>ne()),_="/h5/";async function $(){const o=Y(),{uid:e,uuid:n,token:s}=o;if((e===""||e==="=")&&(n===""||n==="=")&&(s===""||s==="=")){console.log("检测到空值参数，清除本地用户缓存...",{uid:e,uuid:n,token:s}),I(),console.log("已清除本地用户缓存"),p.value=null;return}if(e&&n&&s)try{console.log("检测到URL参数，清除现有缓存并执行自动登录...",{uid:e,uuid:n,token:s}),I(),console.log("已清除现有用户缓存");const i=await Z({uid:e,uuid:n,token:s});if(i.data&&i.data.status===200&&i.data.attachment){const d=i.data.attachment;console.log("获取用户信息成功:",d),ee({uuid:d.uuid,token:s,uid:d.uid,openName:d.openName||"用户"}),p.value=m(),setTimeout(()=>{p.value=m()},100),console.log("用户信息已保存到本地缓存")}else console.error("获取用户信息失败:",i.data)}catch(i){console.error("调用用户信息接口失败:",i)}}function P(){const o=k.query.help;if(o){console.log("检测到help参数:",o),o==="ok"?T.success("助力成功！",void 0,a):T.info(o,void 0,a);const e={...k.query};delete e.help,w.replace({query:e})}}function z(){console.log("=== 点击发布抽奖按钮 ===");const o=m();if(console.log("从缓存获取的用户信息:",o),!o||!o.uid){console.log("用户未登录，无法跳转到发布抽奖页面"),U();return}let e=o.token;if(e||(console.log("缓存中没有token，尝试从localStorage获取"),e=localStorage.getItem("token")||"",console.log("从localStorage获取的token:",e)),!e){console.error("无法获取token，请重新登录");return}const n="https://t-dao.aisky.io/admin",s=te(),g=oe(s);console.log("当前locale:",s,"API格式:",g);const i=`${n}/mobile.html?uid=${o.uid}&uuid=${o.uuid}&token=${e}&locale=${g}#/lottery/mobile`;console.log("跳转到发布抽奖页面:",i),window.location.href=i}function N(){console.log("=== 点击我的记录按钮 ==="),console.log("当前用户信息:",p.value),console.log("本地缓存用户信息:",m()),console.log("isLoggedIn() 结果:",D()),w.push("/my-lottery")}async function L(){var o;f.value=!0,h.value="";try{const e=await le();if(e.data&&e.data.code===0)v.value=e.data.data||[];else throw new Error(((o=e.data)==null?void 0:o.msg)||"获取抽奖活动失败")}catch(e){console.error("获取抽奖活动列表失败:",e),e.message.includes("临时授权")?(h.value="无法获取临时授权，请刷新页面重试",B()):h.value=e.message||"网络错误，请稍后再试"}finally{f.value=!1}}function M(){B(),L()}function A(o,e){if(!o||!e)return"时间待定";const n=new Date(o),s=new Date(e),g=(n.getMonth()+1).toString().padStart(2,"0"),i=n.getDate().toString().padStart(2,"0"),d=(s.getMonth()+1).toString().padStart(2,"0"),F=s.getDate().toString().padStart(2,"0");return`${g}-${i}～${d}-${F}`}function R(o){if(!o)return!1;try{const e=new URL(o);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}}function q(o){return!o||!R(o)?"https://img.aisky.io/api/aQAdzWGNitaaleNn.png":o}return H(async()=>{await $(),P(),L()}),(o,e)=>{const n=J("router-link");return c(),u("div",{class:S(["min-h-screen bg-white relative overflow-hidden w-full max-w-full",j.value])},[t("div",{class:"relative h-48 overflow-hidden",style:K({backgroundImage:`url(${l(_)}lotterylist_bg.png)`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[t("img",{src:`${l(_)}lotterylist_top.png`,alt:"抽奖活动顶部图",class:"w-full h-full object-cover"},null,8,ie)],4),t("div",de,[t("h1",ce,r(l(a)("lottery.lotteryList.title")),1),t("div",ue,[t("button",{onClick:z,class:"px-3 py-1.5 bg-white border border-orange-300 rounded-lg text-orange-600 text-xs whitespace-nowrap flex items-center hover:bg-orange-50 transition-colors",style:{"min-height":"2rem"}},[e[0]||(e[0]=t("svg",{class:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)),b(" "+r(l(a)("lottery.lotteryList.publishBtn")),1)]),t("button",{onClick:N,class:"px-3 py-1.5 bg-white border border-orange-300 rounded-lg text-orange-600 text-xs whitespace-nowrap flex items-center hover:bg-orange-50 transition-colors",style:{"min-height":"2rem"}},[e[1]||(e[1]=x('<svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-bae3e4ed><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2" data-v-bae3e4ed></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1" data-v-bae3e4ed></rect><path d="M12 11v6" data-v-bae3e4ed></path><path d="M9 14h6" data-v-bae3e4ed></path></svg>',1)),b(" "+r(l(a)("lottery.lotteryList.myRecordBtn")),1)])])]),t("main",he,[h.value?(c(),u("div",ge,[e[2]||(e[2]=t("svg",{class:"w-10 h-10 mx-auto mb-3 text-red-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),t("p",me,r(h.value),1),t("button",{onClick:M,class:"mt-3 px-5 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all"},r(l(a)("lottery.lotteryList.retry")),1)])):f.value?(c(),u("div",pe,[t("div",fe,[e[3]||(e[3]=x('<svg width="60" height="60" viewBox="0 0 60 60" fill="none" data-v-bae3e4ed><circle cx="30" cy="30" r="25" stroke="#3b82f6" stroke-width="2" stroke-dasharray="70,50" stroke-linecap="round" data-v-bae3e4ed><animateTransform attributeName="transform" type="rotate" from="0 30 30" to="360 30 30" dur="1.5s" repeatCount="indefinite" data-v-bae3e4ed></animateTransform></circle><circle cx="30" cy="30" r="15" stroke="#60a5fa" stroke-width="2" stroke-dasharray="40,30" stroke-linecap="round" data-v-bae3e4ed><animateTransform attributeName="transform" type="rotate" from="360 30 30" to="0 30 30" dur="1.2s" repeatCount="indefinite" data-v-bae3e4ed></animateTransform></circle></svg>',1)),t("p",ye,r(l(a)("lottery.lotteryList.loading")),1)])])):v.value.length===0&&!f.value?(c(),u("div",ve,[e[5]||(e[5]=x('<div class="empty-state-illustration" data-v-bae3e4ed><svg width="120" height="120" viewBox="0 0 24 24" fill="none" data-v-bae3e4ed><path opacity="0.2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" fill="#3b82f6" data-v-bae3e4ed></path><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#3b82f6" stroke-width="1.5" data-v-bae3e4ed></path><path d="M9 10h.01M15 10h.01M9.5 15a3.5 3.5 0 005.5 0" stroke="#3b82f6" stroke-width="1.5" stroke-linecap="round" data-v-bae3e4ed></path></svg></div>',1)),t("div",be,r(l(a)("lottery.lotteryList.noActivity")),1),t("p",xe,r(l(a)("lottery.lotteryList.noActivityDesc")),1),t("button",{onClick:M,class:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all flex items-center"},[e[4]||(e[4]=t("svg",{class:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M23 4v6h-6"}),t("path",{d:"M1 20v-6h6"}),t("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"})],-1)),b(" "+r(l(a)("lottery.lotteryList.refresh")),1)])])):(c(),u("div",we,[t("div",ke,[(c(!0),u(W,null,X(v.value,s=>(c(),se(n,{key:s.id,to:`/lottery/${s.id}`,class:"block bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer"},{default:re(()=>[t("div",_e,[t("div",Le,[t("img",{src:q(s.background),alt:"抽奖活动背景",class:"w-full h-full object-cover rounded-lg"},null,8,Me),t("div",Ce,[t("span",{class:S(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",s.lotteryType==="wheel"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"])},r(s.lotteryType==="wheel"?l(a)("lottery.lotteryList.wheel"):l(a)("lottery.lotteryList.blindbox")),3)])]),t("div",Se,[t("div",null,[t("h3",Ie,r(s.name),1),t("div",Te,[e[6]||(e[6]=t("svg",{class:"w-3 h-3 mr-1.5 text-orange-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",Be,r(A(s.startTime,s.endTime)),1)]),t("p",Ue,r(l(a)("lottery.lotteryList.sponsor"))+": "+r(s.sponsor||"Aiskymeetup"),1)]),e[7]||(e[7]=t("div",{class:"flex justify-start"},[t("div",{class:"px-6 py-1.5 bg-gradient-to-r from-orange-500 to-red-500 text-white text-sm hover:from-orange-600 hover:to-red-600 transition-all flex items-center font-medium shadow-sm",style:{height:"1.6rem","border-radius":"50px"}}," Open ")],-1))])])]),_:2},1032,["to"]))),128))])]))])],2)}}}),ze=ae(De,[["__scopeId","data-v-bae3e4ed"]]);export{ze as default};
