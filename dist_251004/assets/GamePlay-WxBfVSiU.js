import{d as R,u as S,r as d,y as U,o as q,a as D,c as p,e as v,q as E,m as B,f as n,t as G,w as N,z as V,A as $,_ as I,s as Y,B as P,b as W,x as A,k as T,g as F,l as z}from"./index-sn2Iz1lD.js";import{d as H}from"./game-CibO7eY-.js";const O={key:0,class:"loading-overlay"},j={class:"responsive-iframe-container"},J=["src"],K=R({__name:"GameEmbed",props:{gameUrl:{},gameName:{}},setup(_){const k=_,x=S(),r=d(null),g=d(null),u=d(!0),l=d(!1),i=d(!0);let a=null,w=0,s=0;const t=()=>{l.value?o():x.back()},f=()=>{setTimeout(()=>{u.value=!1,$(()=>{window.matchMedia("(orientation: landscape)").matches&&window.innerWidth<1024&&c()})},1e3)},c=()=>{const e=r.value;e&&(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())},o=()=>{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},M=()=>{l.value?o():c()},m=()=>{l.value=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement),l.value||(i.value=!0,a&&(clearTimeout(a),a=null))},y=()=>{i.value=!0,a&&clearTimeout(a),l.value&&(a=window.setTimeout(()=>{i.value=!1},3e3))},L=e=>{i.value=!0,w=e.touches[0].clientY,a&&clearTimeout(a),l.value&&(a=window.setTimeout(()=>{i.value=!1},3e3))},C=e=>{l.value&&(s=e.touches[0].clientY,s-w>100&&(o(),w=0,s=0))},b=()=>{window.matchMedia("(orientation: landscape)").matches&&window.innerWidth<1024&&(l.value||c())};return U(()=>k.gameName,e=>{e&&(document.title=`${e} - DaoGame`)}),q(()=>{document.addEventListener("fullscreenchange",m),document.addEventListener("mozfullscreenchange",m),document.addEventListener("webkitfullscreenchange",m),document.addEventListener("MSFullscreenChange",m);const e=r.value;e&&(e.addEventListener("mousemove",y),e.addEventListener("touchstart",L),e.addEventListener("touchmove",C)),window.addEventListener("orientationchange",b),window.addEventListener("resize",b),b()}),D(()=>{document.removeEventListener("fullscreenchange",m),document.removeEventListener("mozfullscreenchange",m),document.removeEventListener("webkitfullscreenchange",m),document.removeEventListener("MSFullscreenChange",m);const e=r.value;e&&(e.removeEventListener("mousemove",y),e.removeEventListener("touchstart",L),e.removeEventListener("touchmove",C)),window.removeEventListener("orientationchange",b),window.removeEventListener("resize",b),l.value&&o(),document.title="DaoGame",a&&(clearTimeout(a),a=null)}),(e,h)=>(v(),p("div",{ref_key:"gameContainerRef",ref:r,class:E(["game-embed-container",{fullscreen:l.value}])},[u.value?(v(),p("div",O,h[0]||(h[0]=[n("div",{class:"loading-spinner"},[n("div",{class:"spinner"}),n("div",{class:"loading-text"},"游戏加载中...")],-1)]))):B("",!0),n("div",{class:E(["control-bar",{visible:i.value}])},[n("button",{onClick:t,class:"control-button back-button"},h[1]||(h[1]=[n("i",{class:"fas fa-arrow-left"},null,-1),n("span",null,"返回",-1)])),n("button",{onClick:M,class:"control-button fullscreen-button"},[n("i",{class:E(l.value?"fas fa-compress":"fas fa-expand")},null,2),n("span",null,G(l.value?"退出全屏":"全屏"),1)])],2),n("div",j,[N(n("iframe",{ref_key:"gameIframeRef",ref:g,src:e.gameUrl,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock allow-fullscreen",class:"game-iframe",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",allowfullscreen:"",webkitallowfullscreen:"true",mozallowfullscreen:"true",onLoad:f},null,40,J),[[V,!u.value]])])],2))}}),Q=I(K,[["__scopeId","data-v-bb19bf45"]]),X={class:"game-play-container"},Z={key:1,class:"loading-state"},ee={key:2,class:"error-state"},te={class:"text-lg mb-2"},ne={key:3,class:"no-url-state"},le=R({__name:"GamePlay",setup(_){const k=Y(),x=S(),r=d(null),g=d(!0),u=d("");let l=["游戏加载中，马上就好...","准备好开始冒险了吗？","正在连接游戏服务器...","游戏即将开始，请稍候...","正在加载游戏资源，请耐心等待..."],i=null;async function a(){var t,f,c;const s=k.params.id;if(!s){x.push("/");return}g.value=!0,u.value="";try{const o=await H(s);o.data?r.value=o.data:u.value=((t=o.data)==null?void 0:t.msg)||"获取游戏详情失败"}catch(o){u.value=((c=(f=o==null?void 0:o.response)==null?void 0:f.data)==null?void 0:c.msg)||"获取游戏详情失败"}finally{g.value=!1}}function w(){const s=document.querySelector(".loading-tip");if(!s)return;let t=0;s.textContent=l[0],i=window.setInterval(()=>{t=(t+1)%l.length,s&&(s.textContent=l[t])},3e3)}return q(()=>{a(),w(),document.title="游戏加载中 - DaoGame"}),P(()=>{i&&(clearInterval(i),i=null),document.title="DaoGame"}),(s,t)=>{var c;const f=W("router-link");return v(),p("div",X,[r.value&&r.value.embedUrl?(v(),A(Q,{key:0,gameUrl:r.value.embedUrl,gameName:r.value.name},null,8,["gameUrl","gameName"])):g.value?(v(),p("div",Z,t[0]||(t[0]=[n("div",{class:"spinner"},null,-1),n("p",{class:"loading-text"},"加载游戏中...",-1),n("p",{class:"loading-tip"},"请稍候，精彩游戏即将开始",-1)]))):u.value?(v(),p("div",ee,[t[3]||(t[3]=n("i",{class:"fas fa-exclamation-circle text-red-500 text-5xl mb-4"},null,-1)),n("p",te,G(u.value),1),n("button",{onClick:a,class:"retry-button"},t[1]||(t[1]=[n("i",{class:"fas fa-redo mr-2"},null,-1),F("重试 ")])),T(f,{to:"/",class:"home-link"},{default:z(()=>t[2]||(t[2]=[n("i",{class:"fas fa-home mr-2"},null,-1),F("返回首页 ")])),_:1})])):(c=r.value)!=null&&c.embedUrl?B("",!0):(v(),p("div",ne,[t[5]||(t[5]=n("i",{class:"fas fa-ban text-gray-500 text-5xl mb-4"},null,-1)),t[6]||(t[6]=n("p",{class:"text-lg mb-2"},"该游戏暂不可用",-1)),T(f,{to:"/",class:"home-link"},{default:z(()=>t[4]||(t[4]=[n("i",{class:"fas fa-home mr-2"},null,-1),F("返回首页 ")])),_:1})]))])}}}),oe=I(le,[["__scopeId","data-v-4b09b7bf"]]);export{oe as default};
